---
layout: default
title: Game
full: true
---

<div id="gamescreen" class="game">
<div id="console"></div>
<div id="hover" class="hover">Peer into darkness</div>
</div>

<script>

// Global rooms variable
var rooms = {};
// Global variables for state machine
var globals = {};

// A room needs to scaffolded, e.g. room 'start'
rooms.start = {
    hotspots:[]
};
globals.rooms.start = {};

// Hotspot in rooms need to be scaffolded, e.g. object 'darkness'

/*
@hotspot
{

}
@end
*/

rooms.start.hotspots.push = {
    title:'Peer into darkness',
    x:0,
    y:0,
    width:100,
    height:100,
    active:true
};

// @object darkness clicked { }
rooms.start.objects.darkness.click = async function( locals ) {

}


// @enter { }
rooms.start.enter = async function( locals ) {

}

// @exit { }
rooms.start.exit = async function( locals ) {

}












var gameconsole = document.getElementById('console');
var gamescreen = document.getElementById('gamescreen');
var main = document.getElementById('main');
var hover = document.getElementById('hover');

var currentTimeout;
var currentMessages = 0;
var interfaceLocked = false;

function logKey(e) {
    if (e.code == 'Space') {
        if(currentTimeout) clearTimeout( currentTimeout );
    }
}
document.addEventListener('keypress', logKey);


function mouseMove(e) {
    if( interfaceLocked ) return;
    var x = (e.clientX - main.offsetLeft);
    var y = (e.clientY - main.offsetTop);
    hover.style.left = x + "px";
    hover.style.top = y + "px";
}
gamescreen.addEventListener('mousemove', mouseMove);


function say(message, id) {
    var promise, ms;
    ms = Math.max(2000,message.length*125);
    gameconsole.innerHTML = message;
    currentMessages++;
    promise = new Promise(function(resolve, reject) {
       
        currentTimeout = setTimeout(function() {
           currentMessages--;
            if(currentMessages==0) gameconsole.innerHTML = '';
            resolve('timeout done');
        }, ms);
    });
    return promise;
}


async function mouseDown(e) {
    if( interfaceLocked ) return;
    interfaceLocked = true;
    gamescreen.className += " nointerface";
    await darkness();
    interfaceLocked = false;
    gamescreen.className = gamescreen.className.replace(" nointerface", " interface");
}
gamescreen.addEventListener('mousedown', mouseDown);


async function darkness() {
    await say("It is so black...");
    await say("...I can barely see anything.");
}

</script>
