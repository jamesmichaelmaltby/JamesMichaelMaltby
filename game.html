---
layout: default
title: Game
full: true
---

<div id="gamescreen" class="game">
<div id="console"></div>
<div id="hover" class="hover">Peer into darkness</div>
</div>

<script>
var console = document.getElementById('console');
var gamescreen = document.getElementById('gamescreen');
var main = document.getElementById('main');
var hover = document.getElementById('hover');

var currentTimeout;
var currentMessages = 0;

function logKey(e) {
    if (e.code == 'Space') {
        if(currentTimeout) clearTimeout( currentTimeout );
    }
}
document.addEventListener('keypress', logKey);


function mouseMove(e) {
    var x = (e.clientX - main.offsetLeft);
    var y = (e.clientY - main.offsetTop);
    hover.style.left = x + "px";
    hover.style.top = y + "px";
}
gamescreen.addEventListener('mousemove', mouseMove);


function say(message, id) {
    var promise, ms, timeout;
    ms = Math.max(2000,message.length*125);
    console.innerHTML = message;
    currentMessages ++;
    promise = new Promise(function(resolve, reject) {
        timeout = setTimeout(function() {
            currentMessages--;
            if(currentMessages==0) console.innerHTML = "";
            resolve('timeout done');
            if(resetConversation) {
                resetConversation=false;
            }
            resolve('resolve');

        }, ms);
    });

    currentTimeout = timeout;

    return promise;
}


async function mouseDown(e) {
    gamescreen.style.background = 'red';
    await say( 'hello' );
    await say( 'hello 2' );
    gamescreen.style.background = 'blue';
}
gamescreen.addEventListener('mousedown', mouseDown);


async function conversation1() {
    await say("Hello");
    await say("Welcome to my game");
    await say("This is a test of talking");
}

async function conversation2() {
    await say("But wait...");
    await say("...there's more...");
    await say("...shall we talk some more?");
}

async function game() {
    await conversation1();
    await conversation2();
}


</script>
