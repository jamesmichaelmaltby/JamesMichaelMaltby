<!doctype HTML>
<html>
<script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"> </script>
<script src="https://cozmo.github.io/jsQR/jsQR.js"></script>
<script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js"></script>
<script>
  var canvasElement = document.createElement("canvas");
  var canvasContext = canvasElement.getContext("2d");
	AFRAME.registerComponent('registerevents', {
		init: function () {
      console.log("registering");
			var marker = this.el;
			marker.addEventListener('markerFound', function() {
        console.log('markerFound');
				var markerId = marker.id;
        return;
        video = document.querySelector("video");
        if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
          canvasElement.height = video.videoHeight;
          canvasElement.width = video.videoWidth;
          canvasContext.drawImage(
            video,
            0,
            0,
            canvasElement.width,
            canvasElement.height
          );
          var imageData = canvasContext.getImageData(
            0,
            0,
            canvasElement.width,
            canvasElement.height
          );
          var qrCode = jsQR(imageData.data, imageData.width, imageData.height);
          if (qrCode && qrCode.data !== "") {
            console.log("QR Code Data - " + qrCode.data);
            alert(qrCode.data);
          } else {
            console.log("no qr code found");
          }
        }
			});
			marker.addEventListener('markerLost', function() {
        console.log('markerLost');
				var markerId = marker.id;
        console.log(this.id);
			});
		}
	});
</script>

<body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs='detectionType:mono_and_matrix; matrixCodeType: 3x3; sourceType: webcam; debugUIEnabled: false;' vr-mode-ui="enabled: false">
        <a-assets>
            <a-asset-item id="smiley" src="https://cdn.rawgit.com/KhronosGroup/glTF-Sample-Models/9176d098/1.0/SmilingFace/glTF/SmilingFace.gltf"></a-asset-item>
      </a-assets>
      <a-marker id="default" type='barcode' value='5' emitevents="true" registerevents>
          <a-circle material="side: double; color: #EF2D5E; transparent: true; opacity: 0.5" color="#7BC8A4" radius="0.5" rotation='-90 0 0' position='0 0 0'>
          <a-entity gltf-model="#smiley" position="0 0.5 0" rotation= "0 0 0"> </a-entity>
        </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

 
  </body>
</html>


